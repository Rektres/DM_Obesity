<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Visualización Modelos</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            background-color: #eef3f9;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        h2, h3 {
            color: #2c3e50;
        }

        .section {
            margin: 50px auto;
            text-align: center;
            width: 90%;
        }

        .graph-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
        }

        .left-space, .right-space {
            width: 100px;
            height: 100%;
            background-image: url('decoracion.jpg'); /* Reemplaza con tu imagen */
            background-size: cover;
            background-position: center;
        }

        .plot-area {
            flex-grow: 1;
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .plot-area canvas, .plot-area img {
            margin-top: 20px;
            max-width: 100%;
        }

        .table-area {
            margin-top: 40px;
            overflow-x: auto;
        }

        table {
            margin: 0 auto;
            border-collapse: collapse;
            width: 80%;
            background-color: white;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ccc;
        }

        th {
            background-color: #3498db;
            color: white;
        }
    </style>
</head>
<body>

    <!-- Apriori Section -->
    <div class="section">
        <h2>Reglas de Asociación (Apriori)</h2>
        <form id="form-apriori" enctype="multipart/form-data">
            <label for="file-apriori">Subir CSV para Apriori:</label>
            <input type="file" id="file-apriori" name="file">
            <button type="submit">Visualizar Reglas</button>
        </form>
        <div class="graph-container">
            <div class="left-space"></div>
            <div class="plot-area">
                <canvas id="aprioriPlot" width="600" height="400"></canvas>
                <p><strong>Gráfico de soporte vs confianza</strong></p>
            </div>
            <div class="right-space"></div>
        </div>
    </div>

    <!-- Regresión Lineal Section -->
    <div class="section">
        <h2>Modelo de Regresión Lineal</h2>
        <form id="form-regresion" enctype="multipart/form-data">
            <label for="file-regresion">Subir CSV de Regresión:</label>
            <input type="file" id="file-regresion" name="file">
            <button type="submit">Mostrar Regresión</button>
        </form>
        <div class="graph-container">
            <div class="left-space"></div>
            <div class="plot-area">
                <canvas id="regresionPlot" width="600" height="400"></canvas>
                <p><strong>Visualización de regresión</strong></p>
            </div>
            <div class="right-space"></div>
        </div>
    </div>

    <!-- Árbol de Decisión Section -->
    <div class="section">
        <h2>Árbol de Decisión - Predicción de NObeyesdad</h2>
        <form id="form-arbol" enctype="multipart/form-data">
            <label for="file-arbol">Subir CSV Árbol de Decisión:</label>
            <input type="file" id="file-arbol" name="file">
            <button type="submit">Visualizar Árbol</button>
        </form>
        <div class="graph-container">
            <div class="left-space"></div>
            <div class="plot-area">
                <img id="arbolImagen" src="arbol_decision.png" alt="Árbol de Decisión">
            </div>
            <div class="right-space"></div>
        </div>
        <div class="table-area">
            <h3>Distribución de género por clase predicha (entrenamiento)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Clase</th><th># Hombres</th><th># Mujeres</th><th>% Hombres</th><th>% Mujeres</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Normal_Weight</td><td>244</td><td>134</td><td>64.55%</td><td>35.45%</td></tr>
                    <tr><td>Obesity_Type_I</td><td>13</td><td>102</td><td>11.30%</td><td>88.70%</td></tr>
                    <tr><td>Obesity_Type_II</td><td>0</td><td>149</td><td>0.00%</td><td>100.00%</td></tr>
                    <tr><td>Obesity_Type_III</td><td>260</td><td>173</td><td>60.05%</td><td>39.95%</td></tr>
                    <tr><td>Overweight_Level_I</td><td>132</td><td>89</td><td>59.73%</td><td>40.27%</td></tr>
                    <tr><td>Overweight_Level_II</td><td>185</td><td>207</td><td>47.19%</td><td>52.81%</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Clustering Section -->
    <div class="section">
        <h2>Clustering de Tipos de Persona (K-Means)</h2>
        <form id="form-clustering" enctype="multipart/form-data">
            <label for="file-clustering">Subir CSV de Clustering:</label>
            <input type="file" id="file-clustering" name="file">
            <button type="submit">Visualizar Clusters</button>
        </form>
        <div class="graph-container">
            <div class="left-space"></div>
            <div class="plot-area">
                <canvas id="clusteringPlot" width="600" height="400"></canvas>
                <p><strong>Visualización de los clusters en espacio PCA</strong></p>
            </div>
            <div class="right-space"></div>
        </div>
        <div class="table-area">
            <h3>Características de cada tipo de persona</h3>
            <table border="1" id="centroids-table">
                <thead>
                    <tr>
                        <th>Cluster</th>
                        <th>Age</th>
                        <th>Weight</th>
                        <th>SMOKE</th>
                        <th>CH2O</th>
                        <th>SCC</th>
                        <th>FAF</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Llenado dinámico -->
                </tbody>
            </table>
        </div>
    </div>

    <script>

// ---------- Apriori: tabla de reglas ----------
document.getElementById('aprioriCSV').addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = function () {
        const lines = reader.result.split('\n').slice(1, 11); // Solo 10 reglas
        const tableBody = document.getElementById('aprioriTableBody');
        tableBody.innerHTML = '';
        lines.forEach(line => {
            const cells = line.split(',');
            if (cells.length >= 4) {
                const row = document.createElement('tr');
                cells.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    row.appendChild(td);
                });
                tableBody.appendChild(row);
            }
        });
    };
    reader.readAsText(e.target.files[0]);
});

// ---------- Regresión Lineal ----------
document.getElementById('regresionCSV').addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = function () {
        const lines = reader.result.split('\n').slice(1);
        const x = [], y = [];
        lines.forEach(line => {
            const parts = line.split(',');
            if (parts.length >= 2) {
                x.push(parseFloat(parts[0]));
                y.push(parseFloat(parts[1]));
            }
        });

        const trace = {
            x: x,
            y: y,
            mode: 'markers',
            type: 'scatter',
            name: 'Datos',
            marker: { color: 'rgba(0, 150, 255, 0.6)' }
        };

        // Cálculo de la recta de regresión simple (y = mx + b)
        const n = x.length;
        const sumX = x.reduce((a, b) => a + b, 0);
        const sumY = y.reduce((a, b) => a + b, 0);
        const sumXY = x.reduce((acc, xi, i) => acc + xi * y[i], 0);
        const sumX2 = x.reduce((acc, xi) => acc + xi * xi, 0);
        const m = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
        const b = (sumY - m * sumX) / n;

        const xLine = [Math.min(...x), Math.max(...x)];
        const yLine = xLine.map(xi => m * xi + b);

        const traceLine = {
            x: xLine,
            y: yLine,
            mode: 'lines',
            name: 'Regresión Lineal',
            line: { color: 'red' }
        };

        const layout = {
            title: 'Gráfico de Regresión Lineal',
            xaxis: { title: 'X' },
            yaxis: { title: 'Y' }
        };

        Plotly.newPlot('regresionPlot', [trace, traceLine], layout);
    };
    reader.readAsText(e.target.files[0]);
});

// ---------- Naive Bayes: matriz de confusión ----------
document.getElementById('naiveCSV').addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = function () {
        const heatmapData = {
            z: [[44, 33], [24, 322]], // Matriz de confusión fija
            x: ['No', 'Yes'],
            y: ['No', 'Yes'],
            type: 'heatmap',
            colorscale: 'Blues'
        };

        const layout = {
            title: 'Matriz de Confusión - Naive Bayes',
            xaxis: { title: 'Predicción' },
            yaxis: { title: 'Real' },
            annotations: [],
            margin: { t: 50 }
        };

        // Añadir anotaciones
        heatmapData.z.forEach((row, i) => {
            row.forEach((val, j) => {
                layout.annotations.push({
                    x: heatmapData.x[j],
                    y: heatmapData.y[i],
                    text: val.toString(),
                    showarrow: false
                });
            });
        });

        Plotly.newPlot('naivePlot', [heatmapData], layout);

        // Métricas
        const metrics = `
            <pre>
Reporte de clasificación:
              precision    recall  f1-score   support
  No enfermo       0.65      0.57      0.61        77
     Enfermo       0.91      0.93      0.92       346

    accuracy                           0.87       423
   macro avg       0.78      0.75      0.76       423
weighted avg       0.86      0.87      0.86       423
            </pre>
        `;
        document.getElementById('naiveMetrics').innerHTML = metrics;
    };
    reader.readAsText(e.target.files[0]);
});

// ---------- Árbol de Decisión ----------
document.getElementById('treeCSV').addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = function () {
        const treeImage = document.getElementById('treeImage');
        treeImage.src = 'static/arbol_decision.png'; // Backend debe generar esto
        treeImage.style.display = 'block';

        const tabla = `
            <pre>
Distribución de género por clase predicha (entrenamiento):

                     # Hombres  # Mujeres  % Hombres  % Mujeres
Normal_Weight              244        134      64.55      35.45
Obesity_Type_I              13        102      11.30      88.70
Obesity_Type_II              0        149       0.00     100.00
Obesity_Type_III           260        173      60.05      39.95
Overweight_Level_I         132         89      59.73      40.27
Overweight_Level_II        185        207      47.19      52.81
            </pre>
        `;
        document.getElementById('treeMetrics').innerHTML = tabla;
    };
    reader.readAsText(e.target.files[0]);
});

// ---------- Clustering ----------
document.getElementById('clusterCSV').addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = function () {
        // En este ejemplo asumimos que el backend genera el gráfico como imagen
        const clusterImage = document.getElementById('clusterImage');
        clusterImage.src = 'static/clustering.png'; // Ruta generada por Flask
        clusterImage.style.display = 'block';

        const tabla = `
            <pre>
Características de cada tipo de Persona (centroides):

   Age  Weight  SMOKE  CH2O  SCC  FAF  Cluster
0  25.3   60.1   0.10   2.0  0.2  0.3        0
1  35.1   92.5   0.12   1.1  0.4  0.2        1
2  27.8   70.2   0.08   2.5  0.1  0.5        2
            </pre>
        `;
        document.getElementById('clusterInfo').innerHTML = tabla;
    };
    reader.readAsText(e.target.files[0]);
});
    </script>

</body>
</html>
